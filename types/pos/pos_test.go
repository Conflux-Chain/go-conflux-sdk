package postypes

import (
	"encoding/json"
	"fmt"
	"reflect"
	"testing"

	"github.com/Conflux-Chain/go-conflux-sdk/utils"
	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/assert"
)

func TestUnmarshalTransaction(t *testing.T) {

	type tableTemplate struct {
		data   string
		expect *Transaction
		actual *Transaction
	}

	table := []tableTemplate{
		{
			data:   genTxJsonWithPayload(`"payload": null`, "BlockMetadata"),
			expect: genTxWithPayload(nil, "BlockMetadata"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"blockHash": "0xe18e8f0ff9dbb12d0d27451fea177f277445e244e2524e9b5ea370282fc99565",
				"height": "0xb4bb8"
			}`, "PivotDecision"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "PivotDecision",
				PivotBlockDecision: PivotBlockDecision{
					Height:    740280,
					BlockHash: "0xe18e8f0ff9dbb12d0d27451fea177f277445e244e2524e9b5ea370282fc99565",
				},
			}, "PivotDecision"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"publicKey": "0xb68eb1077fd469f7a9de1c279e74a1bee1fe95ffca2bf88f093e527b0867b7f315b40611a8a10c7da04e9513156ea787",
				"targetTerm": "0x6",
				"vrfProof": "0x0375426a57bfce9c3907f3bb5f621909dc9f7376b9028e72e39bee9d2b51d48d5b0532594580541df6bd829f694b1d7ed6f37dbf7584ec146d90a03ac10312ce17dd3886d50c9e65dc6f27f69fdad59c01",
				"vrfPublicKey": "0x036f20cbf457477fc876202f4fda595ff3bc3d373fb66c23022f1edb67ede1ae34"
			}`, "Election"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "Election",
				ElectionPayload: ElectionPayload{
					PublicKey:    "0xb68eb1077fd469f7a9de1c279e74a1bee1fe95ffca2bf88f093e527b0867b7f315b40611a8a10c7da04e9513156ea787",
					TargetTerm:   6,
					VrfProof:     "0x0375426a57bfce9c3907f3bb5f621909dc9f7376b9028e72e39bee9d2b51d48d5b0532594580541df6bd829f694b1d7ed6f37dbf7584ec146d90a03ac10312ce17dd3886d50c9e65dc6f27f69fdad59c01",
					VrfPublicKey: "0x036f20cbf457477fc876202f4fda595ff3bc3d373fb66c23022f1edb67ede1ae34",
				},
			}, "Election"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"nodeId": "0xe3532f3e329b75d738d46c3356a2cbd5cd75c98b13416c5530bb05db3e1a1d89",
				"votes": "0x1"
			}`, "Retire"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "Retire",
				RetirePayload: RetirePayload{
					NodeId: common.HexToHash("0xe3532f3e329b75d738d46c3356a2cbd5cd75c98b13416c5530bb05db3e1a1d89"),
					Votes:  1,
				},
			}, "Retire"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"publicKey": "0xb68eb1077fd469f7a9de1c279e74a1bee1fe95ffca2bf88f093e527b0867b7f315b40611a8a10c7da04e9513156ea787",
				"vrfPublicKey": "0x036f20cbf457477fc876202f4fda595ff3bc3d373fb66c23022f1edb67ede1ae34"
			}`, "Register"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "Register",
				RegisterPayload: RegisterPayload{
					PublicKey:    "0xb68eb1077fd469f7a9de1c279e74a1bee1fe95ffca2bf88f093e527b0867b7f315b40611a8a10c7da04e9513156ea787",
					VrfPublicKey: "0x036f20cbf457477fc876202f4fda595ff3bc3d373fb66c23022f1edb67ede1ae34",
				},
			}, "Register"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"nodeAddress": "0x941489f181519b7e171f2b485f40909a09fb14716a2fbad5a2996735835257fe",
				"votingPower": "0x3"
			}`, "UpdateVotingPower"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "UpdateVotingPower",
				UpdateVotingPowerPayload: UpdateVotingPowerPayload{
					NodeAddress: common.HexToHash("0x941489f181519b7e171f2b485f40909a09fb14716a2fbad5a2996735835257fe"),
					VotingPower: 3,
				},
			}, "UpdateVotingPower"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
				"blockHash": "0xc50f035607c59ab5fb3f6fce4fed567691fa4c047d14661a5351808e80e9e0a1",
				"height": "0xc498c"
			}`, "PivotDecision"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "PivotDecision",
				PivotBlockDecision: PivotBlockDecision{
					BlockHash: "0xc50f035607c59ab5fb3f6fce4fed567691fa4c047d14661a5351808e80e9e0a1",
					Height:    805260,
				},
			}, "PivotDecision"),
			actual: nil,
		},

		{
			data: genTxJsonWithPayload(`"payload": {
			}`, "Dispute"),
			expect: genTxWithPayload(&TransactionPayload{
				transactionType: "Dispute",
				DisputePayload:  DisputePayload{},
			}, "Dispute"),
			actual: nil,
		},
	}

	for _, item := range table {
		// fmt.Printf("data:%+v", item.data)
		if err := json.Unmarshal([]byte(item.data), &item.actual); err != nil {
			t.Fatal(err)
		}

		if item.expect == nil || item.actual == nil {
			if item.expect != item.actual {
				t.Fatalf("expect %+v, actual %+v", item.expect, item.actual)
			}
		}

		if !reflect.DeepEqual(&item.expect.Payload, &item.actual.Payload) {
			t.Fatalf("expect %+v, actual %+v", item.expect.Payload, item.actual.Payload)
		}
	}

}

func getHashPtr(hash common.Hash) *common.Hash {
	return &hash
}

func getStrPtr(str string) *string {
	return &str
}

func genTxWithPayload(tp *TransactionPayload, txType string) *Transaction {
	baseTx := Transaction{
		BlockHash: getHashPtr(common.HexToHash("0xf747537431108da44bc6e72a379c6bfb79472729d6f9b82e312aae0ef1c0c70e")),
		From:      common.HexToHash("0x046ca462890f25ed9394ca9f92c979ff48e1738a81822ecab96d83813c1a433c"),
		Hash:      common.HexToHash("0x088dcb111055951fb4a357f0afd93a2fe7492ec4181ad638451421348cc98d8d"),
		Number:    183,
		Payload:   nil,
		Status:    getStrPtr("Executed"),
		Type:      txType,
	}
	baseTx.Payload = tp
	return &baseTx
}

func genTxJsonWithPayload(payloadJson string, txType string) string {
	return `{
		"blockHash": "0xf747537431108da44bc6e72a379c6bfb79472729d6f9b82e312aae0ef1c0c70e",
		"from": "0x046ca462890f25ed9394ca9f92c979ff48e1738a81822ecab96d83813c1a433c",
		"hash": "0x088dcb111055951fb4a357f0afd93a2fe7492ec4181ad638451421348cc98d8d",
		"number": "0xb7",` +
		payloadJson + `,
		"status": "Executed",
		"type": "` + txType + `"
	}`
}

func TestUnmarshalLedgerInfoWithSignatures(t *testing.T) {
	expect := `{"aggregatedSignature":"0x02563a28769609616ed73d19a53cfe1d9c7d9e25c5e80f7e3f3b4f1615ca965fe366fd336d28e896d781f25d2f6c242c17dc59a70c2933ed7b2e029b626744769e946be8c5bae933eb622a5ffe90431ba2713a0f29d8ecc6b02062348deb1dd3047fee61a20cb4fd31a4d2cb701a5cf057f75723c5725c1f4116b66cc15c92c75be4d9a0c70d2187faa7ee3e88c7929f067ed6bd5481b5a0a9c66cd3032a62af7718c4a822dca7eba5d836b173244e67770c137db43ebf6397b1673611565a00","ledgerInfo":{"commitInfo":{"epoch":"0x2710","executedStateId":"0x0000000000000000000000000000000000000000000000000000000000000000","id":"0x41b300d738abac6a56dca46f521498b183d200db3af026644fa043051f99fdcf","nextEpochState":{"epoch":"0x2711","verifier":{"addressToValidatorInfo":{"0x07ea967fb13ed5e69201022f56fe05602b4169362cad9eaccc049b4e6a57a50d":{"publicKey":"0xb7ca1d43009c5f97824053aea26f14279ab83e7459bed49d5a5d1eacfa605b6f7515d1e830761900a2020cf78ceda373","votingPower":"0x1","vrfPublicKey":"0x031f921d390d2e49a1a66878f1b87e16581859c040245f0d392787f1c67d9978b1"},"0x231a92cafc2315be2a8c17d8bfbbea22c9b3b4843e7ffd9e02990d259f89935c":{"publicKey":"0x950b06351278c6129c12a7449cf6a2eb616ff89c7685dee5ead919857e43c2d8b748e1e0df0bfa07a7cbe0fa2d5da239","votingPower":"0x23","vrfPublicKey":"0x02a6d18ec5960884571d2307d48a84bd13df154b96514053b3754feece37896693"},"0x243a91338fae1a552f059f7d074999acdc048856bfab71f3903bd5d12a9084e4":{"publicKey":"0xb48353ce7ba3e45d85373d34e333b8cdd2cc773a440e487be2977f6dbba5b80ef5e37ba2ee47eb663f900a20445e3974","votingPower":"0x15","vrfPublicKey":"0x02f9805cff191e8330ef255576c3a9f9664a66e421bee479506542738983b1b97f"},"0x37c838fc8a08bfc5a9c0721aec4e0ca857db51321d9638e557627c637727a699":{"publicKey":"0x81672011119429eca4fd6105d7f3152f813f732c6cc0ee7daedd49423395d55a59bdaae3e0a114812a7a8ba37e7f8fd1","votingPower":"0x1","vrfPublicKey":"0x03025b771d6a824a42c5ba9693670adcd2bbd069fa838872d5074b5b60bea1f5bd"},"0x60df5c013195c715c4d9fd75580c7b856d5dda11986175891dace54ffa76a0d6":{"publicKey":"0x879b9bd00b38618792ab12e6837a2880a9639381928a53a3fe69b33b4976ceecfd82f6dda9e045050b8b57bb1979ac97","votingPower":"0xb","vrfPublicKey":"0x03d5f32edcfc20a23eaae4772b656c1390ea8dd3670cdfdc05fca4e57e4cb27143"},"0x7106fb0c79c06d73ed1d864f5a02f52f957d94b6c39d5d7ab37c21d72620092f":{"publicKey":"0x91fd67805780f415bd4990d9763924572acfd724375d71456b649434092ae16a1a5003a4ec093c2c7dfeb003ddddffdf","votingPower":"0x2","vrfPublicKey":"0x03f132f839836bab201f662977699e79ed509b75b757e8dbb35c4391252e0b0bb0"},"0x75438e9f33b86db42934f9ac1c2b4341ca25a1a6d6648d51ba013e75ea021458":{"publicKey":"0xb1debf0b563a3344f8da1a062a493c3e762f2e23efc68bba65829134e32b6be38e93211b57ed1ecd41c5dd5b76ff2f26","votingPower":"0x14","vrfPublicKey":"0x03042fc0366f4a9ada91a7e6358475be560b8d789dc5eab9f634528380c6a506bd"},"0x771570d4d686d45395729f68236896cc470873876965da8ed45a6f0cf8c67f0c":{"publicKey":"0xb2adc2c4737e028439378a604ab4dc8abfa1be347c019ea5087e34033b595f8bf322e6a762dcebd3764866d7ac13fd25","votingPower":"0x2","vrfPublicKey":"0x02349cfc45e35d96f55a03bfc5075ccaccf2b027baf7a5f00dbd6efec08d6c59e4"},"0x7bb28d4719f3d8562520e5d3b9df5d7b5aec9ae541c3a3f12cef48948b60b172":{"publicKey":"0x8330ee4f32849a2bf1e866e8bce13afbc4ef1315f2ce19dde182349b6fdf25fbf994c03e55eba7c57b467de8f954230e","votingPower":"0x3","vrfPublicKey":"0x03c94047d88633e873286df5e29dcc99a453a4e2d769d724aaf90250907e5c31df"},"0x7feb9aba64be67a99dd59649d5085006021da67a54abb33d3ca0966f3246816c":{"publicKey":"0x8f3cdeaa90be7146ee8215f908fc815dca4f01a7d5b458045bb70c530bde42e38958d5728510c658c1fa298243d6d8bf","votingPower":"0xb","vrfPublicKey":"0x0397b65c8c6f46f0de342857b200d86501b08b58b635b6f0b2c3d5eeb3be7b8f48"},"0x809139093141a6f00f5e01b231756b5b02ff6097fc5277b4e2d9aeb98a22ea08":{"publicKey":"0xa8a0a40d238b8232e199ad6e27c73635fb0fdbbc6024dc06fda496c8231640f74c39c1e5daf70880bd6b8f7ced89e5a2","votingPower":"0x1","vrfPublicKey":"0x02689dd7c9889c11bfd6eb4d91c3b16eaa33cbd472607c9b337dad21c786322593"},"0x92ba044ffdf81232b5ac4ae8f2bfefe45c1607d896d81ac4a354d66c32c773a4":{"publicKey":"0x8e52344bdfa6a6488f29cc363cdf4d12862cc08d90b5b6f23bc64d3cc821424039a61bb4d6d8ca82af3b1a3bc4143408","votingPower":"0x2c","vrfPublicKey":"0x02111d51e1c2561f637f51092a19fee1b0e7a1d08e41078e68b56f932eab03796f"},"0x947c684e270131a1aab8711d2e321fc0e909318d885cfe69d4fc0158aded22d0":{"publicKey":"0x8e5d3e148328c293f9944e9d35bac1d34cca66266b6239beb273269a0e831d00fea387a4acc17dfe90b248e0a2420aa0","votingPower":"0x1a","vrfPublicKey":"0x02dd01a522276c9b2827f147c2e284cc5120bbc3151a08e9a83759b9caebefb3aa"},"0x98804f1a8e879cb3912816ab1dadb493bbe110902358077bd67da17796cd139a":{"publicKey":"0x89b462ef748bceb092f4a46385ceece356c0552509019e8eedead3cd12ce14bb51b3aed6fe3ea5e6ccca1cd3caf9f291","votingPower":"0x16","vrfPublicKey":"0x025551d495d3ed18116b50fa76d631d22284be96fce01324fbc38c8f5dab4c2dc4"},"0xbaeb67e7cd81a788060fdb53badc74177e550bd36585287e4f4a034fb821676c":{"publicKey":"0x900edc75380622cac7fac32dbcf8a19816c861e24e216c6976dc2164aecab54525dc225a2dc7837dc16da6a745f5cc0e","votingPower":"0x23","vrfPublicKey":"0x0320b9b15659a5cc6561ed3661892444fbbdf88a8d58846a053839a8cf3e49cf00"},"0xbec7e19d019851f49580b6748d00adfb589d42bc0758a5fecaa1bfdc7da46c45":{"publicKey":"0x854063b730fa72ff838bef2aa9b09230c95517ba63642e0416b9f76259cf58f693142daae0124a01632979c2ec8d27bf","votingPower":"0x13","vrfPublicKey":"0x02f96260693bf7fc9b9895098ca260293386d0262be2a74d013c4b766e55faa5c4"},"0xbf52b3b6fe4c2778b69f32aaae791b4f5cc0d79bdf782b2599d887ba620aece4":{"publicKey":"0x879a04c9c0bf16b5ddbd015107479f4b40c8a1dbfa2cd664a5428b86a1c6d9f645d4495a6029cc572e6bb94bb5937ffa","votingPower":"0x14","vrfPublicKey":"0x038780d40c300d4bb81d14be5e86460593b1c6245dd97746e978c0306ddafc3410"},"0xd8245b2dde40341356d439a2d83962a394dabd4f5917e56343a7171f7d1c68f6":{"publicKey":"0xb4ffc27625452b2a375459935ae6526412ab1c56cc6b64092b325581622c59d4a1b0b4df79b8752d4ab2c5dcdfe44345","votingPower":"0x2","vrfPublicKey":"0x023cea1dbc449e2c900ee0ea9637877ba015716bf5ddbf776c3968c9449c155bbd"},"0xe6e247242147b83de97e43c6c07afcfe2935aa8a2879e96f29990a04860288ee":{"publicKey":"0x99526386992cc06081a0f6c641501176efd4a31de469feeaf7c4c19697938d810107fdee5726387242af228d041f0eb9","votingPower":"0x1","vrfPublicKey":"0x0381833ba91b016a36b64c50457359a628bf384ab30fff13e73ed979359119e428"},"0xef2693fb1f890a862d5bb4bf43fa0eda4ef37879cb5a4d4472d9bcbd4ec0cd70":{"publicKey":"0x861e78b4b76611dc6707348fb4d7d736c552f43c020fcad2b27fc4c6e0e8220de283ede04aab06ae88f022fd2dc1cb69","votingPower":"0x16","vrfPublicKey":"0x02986545e021c74c6b33a2b9acb067fdf80d4065e41fb653f7c506933878f053a8"},"0xf4b68ad5fdd5269187ac2458e5105af4a3da9b07bf9c15d328e96786639fe72b":{"publicKey":"0x99a0a75f1bb1aefcfd422a9ff3c3967437fc5173154e6459216b8bbe7b5ffaa08a0ee6d917a5f8c4cb59d1caa58776a6","votingPower":"0x1","vrfPublicKey":"0x033e462ccfd9fb450c0389d374fdf3ee6e6bb33da5990e26a4211d6e1197acbd09"}},"quorumVotingPower":"0xc9","totalVotingPower":"0x12c"},"vrfSeed":"0xb87035a9de7f14c6c6c2884a5438338cd7ecbc69b2166174aa3421c1ce2e8c91"},"pivot":{"blockHash":"0x14a92e55181dd4a5dbeaaa88a0b1f45b630eae5a8ae23b5d9f455aea2762bb22","height":"0x43c2aa4"},"round":"0x3c","timestampUsecs":"0x5fb64a6d19a70","version":"0x178089"},"consensusDataHash":"0xb6787a1bb662f5ce9012bd9216871ca828680984235d75404e833f0bf8259bb1"},"nextEpochValidators":{"0x07ea967fb13ed5e69201022f56fe05602b4169362cad9eaccc049b4e6a57a50d":"0x17ca1d43009c5f97824053aea26f14279ab83e7459bed49d5a5d1eacfa605b6f7515d1e830761900a2020cf78ceda3731816a14afe8c3e6fccff0506daf087ea01d6cb464fbeafbf7452beb3f1d45ca316465568c745e51d73616ef96aad2683","0x231a92cafc2315be2a8c17d8bfbbea22c9b3b4843e7ffd9e02990d259f89935c":"0x150b06351278c6129c12a7449cf6a2eb616ff89c7685dee5ead919857e43c2d8b748e1e0df0bfa07a7cbe0fa2d5da2390b81be85517c02b9a045c42d1f458b9ec6a5611bf7c2a75dffe352e708e4ea086d6b8f98aacccfcafa8a42c4b3d7c88b","0x243a91338fae1a552f059f7d074999acdc048856bfab71f3903bd5d12a9084e4":"0x148353ce7ba3e45d85373d34e333b8cdd2cc773a440e487be2977f6dbba5b80ef5e37ba2ee47eb663f900a20445e39741597133f35acf895f32f36d2f1d166fbc9af65277cd15f5ed87c28e54f41f90d5485033ce2e115ab0766b4c6f89bb19f","0x37c838fc8a08bfc5a9c0721aec4e0ca857db51321d9638e557627c637727a699":"0x01672011119429eca4fd6105d7f3152f813f732c6cc0ee7daedd49423395d55a59bdaae3e0a114812a7a8ba37e7f8fd10837d42790fb7370c23de624c8a5030e771ab9c2b95932dd7b3a082325d6baa185d11227810c49091e245bb4e3c405ec","0x60df5c013195c715c4d9fd75580c7b856d5dda11986175891dace54ffa76a0d6":"0x079b9bd00b38618792ab12e6837a2880a9639381928a53a3fe69b33b4976ceecfd82f6dda9e045050b8b57bb1979ac9703791494fecc79befa5390d8d10cb481beec444b18171c638a5413336b6ae9083397b0707261aa37fb2cfaeb85a9c394","0x7106fb0c79c06d73ed1d864f5a02f52f957d94b6c39d5d7ab37c21d72620092f":"0x11fd67805780f415bd4990d9763924572acfd724375d71456b649434092ae16a1a5003a4ec093c2c7dfeb003ddddffdf03a18917873e80eb5dead20e0fbde2e8d166daaa605fb831505363396cf9623fd9c27d7a5449ce178e546101cc73bdf0","0x75438e9f33b86db42934f9ac1c2b4341ca25a1a6d6648d51ba013e75ea021458":"0x11debf0b563a3344f8da1a062a493c3e762f2e23efc68bba65829134e32b6be38e93211b57ed1ecd41c5dd5b76ff2f261318bf83b1cd7895e77368b6654275b852cc9e2293dd7cf9d38afd4f8aeb1a72ba490fc4368bf68395b8b0afb10ef195","0x771570d4d686d45395729f68236896cc470873876965da8ed45a6f0cf8c67f0c":"0x12adc2c4737e028439378a604ab4dc8abfa1be347c019ea5087e34033b595f8bf322e6a762dcebd3764866d7ac13fd2510d1295e51c653c626593ab0413b3ce7fa790b2f7b6e6b9f7e23c3054d67559dc809b18bce1dc9c1bcfdcef493fa086a","0x7bb28d4719f3d8562520e5d3b9df5d7b5aec9ae541c3a3f12cef48948b60b172":"0x0330ee4f32849a2bf1e866e8bce13afbc4ef1315f2ce19dde182349b6fdf25fbf994c03e55eba7c57b467de8f954230e0b96d1883df46474cacc2b34f520d4d2cd9583c252a081c769e801f361d483c5fcf15961a4f3c1cfd43b36fe5a8c284d","0x7feb9aba64be67a99dd59649d5085006021da67a54abb33d3ca0966f3246816c":"0x0f3cdeaa90be7146ee8215f908fc815dca4f01a7d5b458045bb70c530bde42e38958d5728510c658c1fa298243d6d8bf072ec93525a3ad157382268b7ed89626dd02acce73b76dc6ea34f69b660479ac933fad647bf348b88b8693940f9a1744","0x809139093141a6f00f5e01b231756b5b02ff6097fc5277b4e2d9aeb98a22ea08":"0x08a0a40d238b8232e199ad6e27c73635fb0fdbbc6024dc06fda496c8231640f74c39c1e5daf70880bd6b8f7ced89e5a2105015e194439f9f4435ca5a52d3303119091d17bdf0f086ca097e9bc7a2939ae3fba25ab893fa151c4022441b0d4515","0x92ba044ffdf81232b5ac4ae8f2bfefe45c1607d896d81ac4a354d66c32c773a4":"0x0e52344bdfa6a6488f29cc363cdf4d12862cc08d90b5b6f23bc64d3cc821424039a61bb4d6d8ca82af3b1a3bc41434080af9e57377c8e15d36541832154ad5b490e3c4dff2021ad9bda118a7fdfc6e0d62704bddd6bd1c1a6acc99af453f23a9","0x947c684e270131a1aab8711d2e321fc0e909318d885cfe69d4fc0158aded22d0":"0x0e5d3e148328c293f9944e9d35bac1d34cca66266b6239beb273269a0e831d00fea387a4acc17dfe90b248e0a2420aa00cec48e274e1b976336ff7f79a6d674208ea22273bb239540955fde3de2d8d11975baa15175081643e82c914e2b202b8","0x98804f1a8e879cb3912816ab1dadb493bbe110902358077bd67da17796cd139a":"0x09b462ef748bceb092f4a46385ceece356c0552509019e8eedead3cd12ce14bb51b3aed6fe3ea5e6ccca1cd3caf9f2910beb8a93801c70af07261c607ed983eaad838d5b4fa71c06a74fb08910d7d5be1c0ecdd8cdfe7db14217112f44194d9a","0xbaeb67e7cd81a788060fdb53badc74177e550bd36585287e4f4a034fb821676c":"0x100edc75380622cac7fac32dbcf8a19816c861e24e216c6976dc2164aecab54525dc225a2dc7837dc16da6a745f5cc0e09ab481020ba040568130c7460e540abbcc3195642436d019bd479c4addbebc1f5844b1beb30a049764a2cb553f8f2f7","0xbec7e19d019851f49580b6748d00adfb589d42bc0758a5fecaa1bfdc7da46c45":"0x054063b730fa72ff838bef2aa9b09230c95517ba63642e0416b9f76259cf58f693142daae0124a01632979c2ec8d27bf0a42280349b413cdf099a767487dffd74afb252457d556e17da42ed33e470f2b78db28e833b864ce7bf0e7aa6ae5cb8f","0xbf52b3b6fe4c2778b69f32aaae791b4f5cc0d79bdf782b2599d887ba620aece4":"0x079a04c9c0bf16b5ddbd015107479f4b40c8a1dbfa2cd664a5428b86a1c6d9f645d4495a6029cc572e6bb94bb5937ffa012d200e0eecf75483e4bfaac605dc34dbff7a2c74ca52ef66f2fcbd3d5f7d7ac00ce884fe8461baaf92c4ef4fda82b1","0xd8245b2dde40341356d439a2d83962a394dabd4f5917e56343a7171f7d1c68f6":"0x14ffc27625452b2a375459935ae6526412ab1c56cc6b64092b325581622c59d4a1b0b4df79b8752d4ab2c5dcdfe4434513b01bc445ac89ffb13de8c83d3d9882c182a240678d7899df3c357164043274d5e5a5d1967c2a15c54bcda787f5f362","0xe6e247242147b83de97e43c6c07afcfe2935aa8a2879e96f29990a04860288ee":"0x19526386992cc06081a0f6c641501176efd4a31de469feeaf7c4c19697938d810107fdee5726387242af228d041f0eb900c20a52660ab8aeb3ef266d7c84adb5a2f147c7403f2c70e5f38859c63fbfa39dc65e5b4e34dadb076f9bb8c3cea105","0xef2693fb1f890a862d5bb4bf43fa0eda4ef37879cb5a4d4472d9bcbd4ec0cd70":"0x061e78b4b76611dc6707348fb4d7d736c552f43c020fcad2b27fc4c6e0e8220de283ede04aab06ae88f022fd2dc1cb6904a50eeaa1e176ff0d39f67178d06dca59faaeceefd5a7ce2d270981839f904b9239cb140a8afbc40aa0f117ffdc6680","0xf4b68ad5fdd5269187ac2458e5105af4a3da9b07bf9c15d328e96786639fe72b":"0x19a0a75f1bb1aefcfd422a9ff3c3967437fc5173154e6459216b8bbe7b5ffaa08a0ee6d917a5f8c4cb59d1caa58776a6024e3cdf8668e451eb6f5b941b29c2f6cbd604ca17948e2ccafc0a8efdc98fd2e391c87a7e3ffd627adb01484b6affe6"},"signatures":{"0x07ea967fb13ed5e69201022f56fe05602b4169362cad9eaccc049b4e6a57a50d":"0x127900a306466f8f26abdc0a51d608ea689a74b57774c46397aede19e36834d37bb61f336618eb70fc76ee9a15639abb11d3a4d913d0f42b631d4609fc563816e9f3edbe206dc757150bfe881f689ff2e743e2027f9f5a02950930e5b124a9630414d0c1783fe2ece824ecc2e3d378d0c8d311464a61d08e7bb5fbe1ae7aeb022cdb4167d646f7d21aa7732df83b618f05ff46ea63f6f02f9deed3f5d8c427df04acaa7057682d2c2afbe8ec988d3eddaf6e72c43e2386f5fbaf53f824715c60","0x231a92cafc2315be2a8c17d8bfbbea22c9b3b4843e7ffd9e02990d259f89935c":"0x0f729c82c873b8d4eb4bec0185ce29bd1546276b274ceace6323f2d5c177864e399e359ffb4d8d9711255bfbde1f567c196bee7268a3b8f8bcb533d6150930028336dacaec88098102f1828db25a2bc6e3448314e0058e210ba758f02e9d26d718a31c4b45a29627820e9e18b3ff7cd88df065eb9c20c3436a92940b31b69b47419fd9a0c849ab2a7cbf4d8b6cbe03860f5efca191fbaf7d09e0a8efddd1f0fbfac6bcbf1fe6f2c6fc3bdcbd9ccdafc5b2421598b222402654529c61b4d462a2","0x243a91338fae1a552f059f7d074999acdc048856bfab71f3903bd5d12a9084e4":"0x12db9c0040b8fe31c01dfac5d46f96546608ac7d343e9e247d9a773feec5f2a9c39531486907d9c7efcc48d8c8d8a8370799614aaf0cf51d461d5979a6332e0dad670f2a5068ba9a771ea01db4d83512c171864c7c70bf6ed2194b591c6c3a8302f06bb76067c00e6f44b19e428486c509d81081f2591f684ab0cb9b30a724b02b1fe1511eae984d25736e8c9878a9fa14a950ecc9c59568aaba00bd4d1049c364f2ee64404c49a401bd566e387be9f623534d00f8f9ea7fcdb1652ae506b559","0x37c838fc8a08bfc5a9c0721aec4e0ca857db51321d9638e557627c637727a699":"0x0fa4896d639555c722cfed092ac54c8462bd54aaadc5f8009a60a76354045c1da0e68baec453655d8339c4c3093c9a4b0e2b76729a88344b262dd83a4cfdb779ed4229e9fec0618580b6dc9b67fc2a4ffed2dee8ee14d9cf988cd62d6f1451f116e369b4aa25b8ed3a6e6581e2191ea597d5321b601759c0a5eb861efaec998a2be168b74e6643f1eca0f14cff629827090b2dee6c142178fb3eee7ee775808eb475b69e1a04eb549688735d1605e48cd7bbe012578bdcd4c03754c1f8fc4eb6","0x3eb5090e765b630bb1451e47b1c4523ae355465bb9062b6d4b5468aa500fd251":"0x06e058b04f7ff45b7e7fa5b4d603020b6297c1be518589a58695a147ba1e9e3ff02acd4adb2b996739f9fa2ae18abbec009eef9405534c4315fd5d11d53617ba1d1f7a5b93f14ebd48abca5106f7e34e274d23c24a8844f6cee0ee0343ea33ec019f7654ca3e3a3bcc77f537226961c3f77be34a399864316706f069ab52f0be9cb906c899d5a00a812bc065d980197c05473fee4372f79db58672e598eadf5fa6ddce20c89162d050c57e56061de3126f404ad289f8a46e9f3dfa3410984327","0x60df5c013195c715c4d9fd75580c7b856d5dda11986175891dace54ffa76a0d6":"0x021fe189412dbb239ecf02b613dc0d6b465ab6529434309bedba33860d72c847046ab09309e9bb3b308042f7fb3b02c90282bbc6eb07cb3902dc47490b3a0bf531c229f9aedef1906b510a8107a00d5cedcd58579e72d8ccd1dd0dbf4a8110071011d037cd1b6f016ec51bd1e37ee5b46c9e6af0e14230ebc91a155264ceef0f0f9a8abc2d04d981acc6efe1abe538220a6a2480a94de9b49c978a0bdbb57fcc2968259b6f002c2e2a6dff9e5586dee044ab4521322623c57429d56eaf46da67","0x7106fb0c79c06d73ed1d864f5a02f52f957d94b6c39d5d7ab37c21d72620092f":"0x027029798472acee14f7a5d052279bcc3fee8d54702161f1ce702ff5836f6962acb65878b5fee88ed9d58e33504b10810a2f850ead38774a3560adf2526f6ddfdbcc06b60b48af9697dbc74c77679d9f886812309776800e73dd02ad198deb2902f8aff63ff156cd442f68f8293affa66c9a984544d2376b951083380de378bff46f0c1835488782a877e50b16f25bba0eecdd7ab3776168e61e463cd1b6789d6d6e7db09305366c4c3bcb9878589975980f9bbb6eadd5df72cbb66f6cdc3622","0x75438e9f33b86db42934f9ac1c2b4341ca25a1a6d6648d51ba013e75ea021458":"0x0956f9a326dd933294f058b01c903a8769c751dd0f852daffec25eb53a7f481d5091719c5fcc114c17ae2e9d61e8af310ebb7dc70b8b80a69c7337ca2fe8fdf3c49713d5e29d90f029100e090226b2c10fb020585c92a97ea6ad27f2610abd871217f1fe5c41515fac52f9ca8d4f2de7a4234126c43f942bf9a2f60f6d2d6f9328150f84644b07f57c9c7c308d4dd7b20cd0a3e4ab46d75fecb589448b8bcd78aa1376f3aac73debf47d3fee8659936686f1b1275fcf9bd8c23b9b54354ec020","0x771570d4d686d45395729f68236896cc470873876965da8ed45a6f0cf8c67f0c":"0x1432b7d623cc077f69a54df9fe342b95bea595fccb1f91fcf09105a736dc29abc976fc65f93793d3cf8d1072582b63de1570e6143c8d1886b2fa72c03aa4441f2ba7631c8328877dbc97b7c678ea53faf93e2b9fc89cefefa8537b2fd519dd430655a3e6944f6a93373f61ecb75257d60ed5a7d85b6bed48e8f129af42789e5738db9513ba4051afecd6a531b5907a4c03aedc30aa758b26420de13cff4c3db4840a979839bc7afd3c758d5354ca487c3060b34b7dc97ea4553c1655f062e5f2","0x7bb28d4719f3d8562520e5d3b9df5d7b5aec9ae541c3a3f12cef48948b60b172":"0x07e1bcd1168d31fbee3a6fc510e27bc5c92b434797b4ecdbb92eaf06850dd29d1687e7fc16df565a7612608c504a43170ce85830c9cfe568d6a9457b1d9e0c2604c42b558208bbd3a09d0e9352150512370d1d4491a3ab5b3fff3bfc25bcf70610fb05cad3937a4d39b7a82402cda61b9c8d35c98f8e438e1e1d10ff3f65dee3fde07842e68b6d8beb2cf6959654ea7f023352393d43ebc5c05a434ce2373fb0156764c747a121df851f3c7a2eca9d4677af22eada35243c99547fa292464c07","0x7feb9aba64be67a99dd59649d5085006021da67a54abb33d3ca0966f3246816c":"0x0c84a578683a234b5dcef866ba12d41eba0663088d1bc213fc42e0ceb95eb11251616dd0385b531d87eb76467a93c5cf053354bb2b67c91f595d24518e3770330d28509bd602963dd92afeaa7c1528c446757c5d7262f124b5effa7b7a0aec3512d8ad462bc5d023fa4be11dcf2a6fba958e5a04374916e8a51f8cc4edab2ae71c394b607bf73f97f9695df22167b5c10fe2403ce6ba3bb2cd506337e52703ad6b8150c365ae82700cb30efee4085fb741274e7e4641e63001b7ad7b3d9630b6","0x809139093141a6f00f5e01b231756b5b02ff6097fc5277b4e2d9aeb98a22ea08":"0x1145472abf6b9ecc669b0cc0d180c3d08c9fa016b84b0204d4ef95e7be1451cf422a8ce1ddb0c4007deea5a270fef5400eac2158d0b5e7702daed8d6858187e91b30d11f6e39b64a679f306d4a7d35ef7661473665cdce3bac1e94fe76734c6b057a57393d42b5712e592a543a5ad44dbafb6c53fcc37ebcae0b74acde283dc8cff976a76d71b048e29d9e073065b57e16bddf144d8d7f11abcacf993ae25ae140022e4378d162347d647890728d80077a7bca401340f7de0178762fe3e56660","0x92ba044ffdf81232b5ac4ae8f2bfefe45c1607d896d81ac4a354d66c32c773a4":"0x02b83f3a7f80b20d21187ef9c0d7158332f01b5ab9be671e87bd193aafed76037af8f2260c009423878de323ae8ec05a19e5d08a775a00be5d50bd364324cd9cb5cd057723ab490ff3ea3051a74312a27895f9c1f63d52b5affc593884ddba9815b484b49ee485fe507026555affa0f137ff0219c6d58a082ea16361817d5b0a47f8d3ded13e5a210b50dc2b05cfaea90713454d0e3839c12b7b553dee19a0e96aecc2c1a3e52ec3d3a045ae6fd87ece82bd6d4b2bdd36eaae01fff679118891","0x947c684e270131a1aab8711d2e321fc0e909318d885cfe69d4fc0158aded22d0":"0x0e4b559cb0cf3b9455cd307d9d3e29dfa6829464d467a123f7794b6c613caee27743c54a2fb1de8160aa1b7b4fa98ff70b75cef8773ba604e8f09d4eda6f37d7ad6ea40ff11435ba124b5e53e1141d43463874a3bf229176966334c34e5862b90a5c3e6d6bbd43fba2e3ed472da1f4160350843b20015614baae91e1fc1c5cd5ba2e4a582ce0e2f9b77e0f82a75da8ad014b65afa9bd9c48e089d72195f237b36567208edd12650b601163b34994f53e9a07d324aec1df6b4427595d356d1fd8","0x972945f97f35e57fb0d34f5d5632a57da6da0d0dfafe6f7d79e9a1a6c1a0c70a":"0x01d8abe3f534a903379d4dfae7937467505d47362f9e4a38bbec224d55ab7a8b00491880a56333fcccedbf7d7c36a66018034f7354dc2e4d1e1235241b0c6dd48d5aa64ae0782b8ea1554191f3a18268ce5fed99f892e24d0a456849ae4ecf021740862291ffefbbe368f1d833cf9763f206942fcce956dd2f37a32222561b66901e66dd157d7d234ed47e26f95fd34b01a0e2156309b41f94a5745c2b074d269575c39f0975d67858cf8944d2e84cf13fcf512d8581f05926828248998ad5b9","0x98804f1a8e879cb3912816ab1dadb493bbe110902358077bd67da17796cd139a":"0x05b7588be43d0319a73358441e6d87d343ba583167a0c6853bee0f8aad1b215cf95dfd5058a752e84ea3ee6e539abd4e157c90b7b3c78dc92edc3158f743a27522d5fceb91e2963c7f4b9e2059ff74242e23467068738e72a24ab5c25e15e858167332b82e724f87c3b40f3768e17f8214e3918436fe3bd0f988dabb00cf2e07be3b7881b6056970d9a38431c59e39f01243c061fbcfbeabfd28b9ec1e5bd7cebcdd59701e4bfd4bb5dc8ad73430487daf084f300deff263cf099b79f888906b","0x9e63ddb4b9e9fd770ca02fb285af4237cb0a65a269ff40e747e80d93374e6fc6":"0x12c27255c003f4494ddf5034e78349e0cf5675423189a76c2ad4e681a9594e65db6861d949ef98a9c3f0df24488c597c16ceb1605c9518b9e3365eba243919400f887596d3d25cd47852efbef37d4ebc5796ae231b912d2655607e2bb24a12d711cb5ae490d8d6965917213a272033a089a78cc51c67f32dd83c146c9a393ba1b2eeeecec9f2efec609fcb8abb6b54720972dd7bc678b32bf7706b72e430d1442398f249ce57d485474b1a40bd2621cad7941dde3f57b9d0aa48a9af0ef8ccdf","0xbaeb67e7cd81a788060fdb53badc74177e550bd36585287e4f4a034fb821676c":"0x16fb48350616dc3c53c9b344a73489edf68d8cba8751b74afb70b1472e5de34a675b55c11de1df55ccba2d21230ec7f60df16c5484e068f3291c81c55d0db8271a2cc378bccbaadd418e35ea5ca90c2ffb8d302d4b56a188ea294aa2989cc6d80d87f0bf77e41c576bda2b76f32ee57f5b39e7936851d7bc14d70b17da6f90f2496fe621ed0bb6758a04032d9044a29813c208a24308f2b62657aeca4ca5ddd4631fe71e6443e626dd5eb9f1cd8ab6d0596b4511df7cb23d33229cc3d6f2de27","0xbec7e19d019851f49580b6748d00adfb589d42bc0758a5fecaa1bfdc7da46c45":"0x0513ee18f6011758ea8018648d5288cc8a4f27380ff6049e0b05a80f101138e180b097c1bb68b0ac28d339c23db38b010ef985d6358f4641d39a79c2e9ec47d3a3600580c378e893d725ffa998dbc8349a4b4e49bb3ba12af5cdc7592a84d8760adb960b5a7c2711c2accdfeaee1d82236ab5d8e1a87edba62a451ca197b207928abb215ccc788ee4a0c07b7692a6581180f21513a235164f530563c161190ef14413c4458d94ad421b27d0014c7163e0ca9e18d77df8842548f165e77941ec5","0xbf52b3b6fe4c2778b69f32aaae791b4f5cc0d79bdf782b2599d887ba620aece4":"0x102066061ddc5d272ddedee7dfed197689958b659c69c50ad33c1d62feddaba7ae06882e1f4ddab89dfde1685d17f7160afc0361c75ed3448e1e0c2c7b325ca6fb46a455633ff90772969c9397e234cc90468f6a972b0a3a0ae6c80b74b41cbc08f6e203ce11ae7e8868bf5b5b7cc82da6f352b55573035e4270553da441e552806c5cae6d80dea15daeb3f50b075a8612bd018d4ec1be7327e9fc6b0ff3b14823247b4b78a4f209fead3be46e0a18d2a4763ca41d8e444d3ba63ef340fe66bd","0xd8245b2dde40341356d439a2d83962a394dabd4f5917e56343a7171f7d1c68f6":"0x174d9f3d7eab7d64ecc4ae219c022fa22d86ca14e686fd8f2693e6493ca5920f6c6ca771a88244e904e1daea476cfcca08a73936861e39e7a0b1cb07a10102f9e68fc87fa33aaa0d3bda5fce1197065364b9229bf8d152f53c4a01bc2f3d81490b5ea6da392fe370053e2e63a0cbd2366ee243a073fc3d1c61b2018d672f97738efe3545b693590f12e471311e4664740124251a670fbbd425ecb1d8429ac1cdde89feaf7967b73975c2a0e1a3dcc3de91bbfe4f15c95692ae9ea1b196beabb6","0xe6e247242147b83de97e43c6c07afcfe2935aa8a2879e96f29990a04860288ee":"0x0c3d16a26dffe0ed89fd1d9d27d4674aed186f0d9465c9e70d62348297b4728567d9c8c5e7aec5160114736d35cbea370579f83b1bc6e5169f38b23f37eea8eaf10ed41d9ee8c33cc48d56bce0f069640acde8166f7330e0551ef1402c4d820a154d20d3c16cec21a037b45ff41774961009c173a8ff5110926fb97faba4de4537d83eaa6b17d3d3d02eaae02626190e09d0a3504eb94aeb10f4cd02fee1530a37206a25fe670ca3b2d95f2af365f0ef2f3730e7ce7b0601e478efc07bac39e6","0xef2693fb1f890a862d5bb4bf43fa0eda4ef37879cb5a4d4472d9bcbd4ec0cd70":"0x045371060b59d26708c60e240fcff253dc8d5cc4a5704780d63a591d9d2a09b817ee01e57d80dfa333fcbfd16aeb5a2816450ec702dc607a69d489bb0f314a261fbf662fddcde7752db1908664c61aaa0a22c318d6c4f48746343a723eaf92231091ca282ffd892161e668d082c5107f6633ef52e7bd3f176e481a6a439cf3cd0c0d230eb586d6634b6bcacb6e5705fe182eced5f6197a9d1fe885636df739f97cec403ddbbfff55051673e5f48a3b99134ed37de5b56ccac54185b19a688904"}}`
	var l LedgerInfoWithSignatures
	err := json.Unmarshal([]byte(expect), &l)
	assert.NoError(t, err)

	actual, err := json.Marshal(l)
	assert.NoError(t, err)

	fExpect, fActual := utils.FormatJson(expect), utils.FormatJson(string(actual))
	assert.Equal(t, fExpect, fActual)
}

func TestUnmarshalEpochState(t *testing.T) {
	expect := `{"epoch":"0x2710","verifier":{"addressToValidatorInfo":{"0x07ea967fb13ed5e69201022f56fe05602b4169362cad9eaccc049b4e6a57a50d":{"publicKey":"0x17ca1d43009c5f97824053aea26f14279ab83e7459bed49d5a5d1eacfa605b6f7515d1e830761900a2020cf78ceda3731816a14afe8c3e6fccff0506daf087ea01d6cb464fbeafbf7452beb3f1d45ca316465568c745e51d73616ef96aad2683","votingPower":"0x2","vrfPublicKey":"0x031f921d390d2e49a1a66878f1b87e16581859c040245f0d392787f1c67d9978b1"},"0x231a92cafc2315be2a8c17d8bfbbea22c9b3b4843e7ffd9e02990d259f89935c":{"publicKey":"0x150b06351278c6129c12a7449cf6a2eb616ff89c7685dee5ead919857e43c2d8b748e1e0df0bfa07a7cbe0fa2d5da2390b81be85517c02b9a045c42d1f458b9ec6a5611bf7c2a75dffe352e708e4ea086d6b8f98aacccfcafa8a42c4b3d7c88b","votingPower":"0x20","vrfPublicKey":"0x02a6d18ec5960884571d2307d48a84bd13df154b96514053b3754feece37896693"},"0x243a91338fae1a552f059f7d074999acdc048856bfab71f3903bd5d12a9084e4":{"publicKey":"0x148353ce7ba3e45d85373d34e333b8cdd2cc773a440e487be2977f6dbba5b80ef5e37ba2ee47eb663f900a20445e39741597133f35acf895f32f36d2f1d166fbc9af65277cd15f5ed87c28e54f41f90d5485033ce2e115ab0766b4c6f89bb19f","votingPower":"0x15","vrfPublicKey":"0x02f9805cff191e8330ef255576c3a9f9664a66e421bee479506542738983b1b97f"},"0x37c838fc8a08bfc5a9c0721aec4e0ca857db51321d9638e557627c637727a699":{"publicKey":"0x01672011119429eca4fd6105d7f3152f813f732c6cc0ee7daedd49423395d55a59bdaae3e0a114812a7a8ba37e7f8fd10837d42790fb7370c23de624c8a5030e771ab9c2b95932dd7b3a082325d6baa185d11227810c49091e245bb4e3c405ec","votingPower":"0x1","vrfPublicKey":"0x03025b771d6a824a42c5ba9693670adcd2bbd069fa838872d5074b5b60bea1f5bd"},"0x3eb5090e765b630bb1451e47b1c4523ae355465bb9062b6d4b5468aa500fd251":{"publicKey":"0x068f85caceb6d9b196e9e7cf9f48005161b5588dbd4c7cfa34bdb90417ff79813cd73d346d0bed6ff4d4283bf7641f2f08398e6d417ce0f91635b2d747a5a832c7c5accd0343d0bf60a2816a483dad5d002e9a783bf7f68efe0c3c258164fef6","votingPower":"0x1","vrfPublicKey":"0x02490ebd4ee2179455ad22bbb1e97d2c4c98e00ec60d14953280daa88c298132f5"},"0x60df5c013195c715c4d9fd75580c7b856d5dda11986175891dace54ffa76a0d6":{"publicKey":"0x079b9bd00b38618792ab12e6837a2880a9639381928a53a3fe69b33b4976ceecfd82f6dda9e045050b8b57bb1979ac9703791494fecc79befa5390d8d10cb481beec444b18171c638a5413336b6ae9083397b0707261aa37fb2cfaeb85a9c394","votingPower":"0xd","vrfPublicKey":"0x03d5f32edcfc20a23eaae4772b656c1390ea8dd3670cdfdc05fca4e57e4cb27143"},"0x7106fb0c79c06d73ed1d864f5a02f52f957d94b6c39d5d7ab37c21d72620092f":{"publicKey":"0x11fd67805780f415bd4990d9763924572acfd724375d71456b649434092ae16a1a5003a4ec093c2c7dfeb003ddddffdf03a18917873e80eb5dead20e0fbde2e8d166daaa605fb831505363396cf9623fd9c27d7a5449ce178e546101cc73bdf0","votingPower":"0x2","vrfPublicKey":"0x03f132f839836bab201f662977699e79ed509b75b757e8dbb35c4391252e0b0bb0"},"0x75438e9f33b86db42934f9ac1c2b4341ca25a1a6d6648d51ba013e75ea021458":{"publicKey":"0x11debf0b563a3344f8da1a062a493c3e762f2e23efc68bba65829134e32b6be38e93211b57ed1ecd41c5dd5b76ff2f261318bf83b1cd7895e77368b6654275b852cc9e2293dd7cf9d38afd4f8aeb1a72ba490fc4368bf68395b8b0afb10ef195","votingPower":"0x14","vrfPublicKey":"0x03042fc0366f4a9ada91a7e6358475be560b8d789dc5eab9f634528380c6a506bd"},"0x771570d4d686d45395729f68236896cc470873876965da8ed45a6f0cf8c67f0c":{"publicKey":"0x12adc2c4737e028439378a604ab4dc8abfa1be347c019ea5087e34033b595f8bf322e6a762dcebd3764866d7ac13fd2510d1295e51c653c626593ab0413b3ce7fa790b2f7b6e6b9f7e23c3054d67559dc809b18bce1dc9c1bcfdcef493fa086a","votingPower":"0x2","vrfPublicKey":"0x02349cfc45e35d96f55a03bfc5075ccaccf2b027baf7a5f00dbd6efec08d6c59e4"},"0x7bb28d4719f3d8562520e5d3b9df5d7b5aec9ae541c3a3f12cef48948b60b172":{"publicKey":"0x0330ee4f32849a2bf1e866e8bce13afbc4ef1315f2ce19dde182349b6fdf25fbf994c03e55eba7c57b467de8f954230e0b96d1883df46474cacc2b34f520d4d2cd9583c252a081c769e801f361d483c5fcf15961a4f3c1cfd43b36fe5a8c284d","votingPower":"0x5","vrfPublicKey":"0x03c94047d88633e873286df5e29dcc99a453a4e2d769d724aaf90250907e5c31df"},"0x7feb9aba64be67a99dd59649d5085006021da67a54abb33d3ca0966f3246816c":{"publicKey":"0x0f3cdeaa90be7146ee8215f908fc815dca4f01a7d5b458045bb70c530bde42e38958d5728510c658c1fa298243d6d8bf072ec93525a3ad157382268b7ed89626dd02acce73b76dc6ea34f69b660479ac933fad647bf348b88b8693940f9a1744","votingPower":"0x13","vrfPublicKey":"0x0397b65c8c6f46f0de342857b200d86501b08b58b635b6f0b2c3d5eeb3be7b8f48"},"0x809139093141a6f00f5e01b231756b5b02ff6097fc5277b4e2d9aeb98a22ea08":{"publicKey":"0x08a0a40d238b8232e199ad6e27c73635fb0fdbbc6024dc06fda496c8231640f74c39c1e5daf70880bd6b8f7ced89e5a2105015e194439f9f4435ca5a52d3303119091d17bdf0f086ca097e9bc7a2939ae3fba25ab893fa151c4022441b0d4515","votingPower":"0x1","vrfPublicKey":"0x02689dd7c9889c11bfd6eb4d91c3b16eaa33cbd472607c9b337dad21c786322593"},"0x92ba044ffdf81232b5ac4ae8f2bfefe45c1607d896d81ac4a354d66c32c773a4":{"publicKey":"0x0e52344bdfa6a6488f29cc363cdf4d12862cc08d90b5b6f23bc64d3cc821424039a61bb4d6d8ca82af3b1a3bc41434080af9e57377c8e15d36541832154ad5b490e3c4dff2021ad9bda118a7fdfc6e0d62704bddd6bd1c1a6acc99af453f23a9","votingPower":"0x26","vrfPublicKey":"0x02111d51e1c2561f637f51092a19fee1b0e7a1d08e41078e68b56f932eab03796f"},"0x947c684e270131a1aab8711d2e321fc0e909318d885cfe69d4fc0158aded22d0":{"publicKey":"0x0e5d3e148328c293f9944e9d35bac1d34cca66266b6239beb273269a0e831d00fea387a4acc17dfe90b248e0a2420aa00cec48e274e1b976336ff7f79a6d674208ea22273bb239540955fde3de2d8d11975baa15175081643e82c914e2b202b8","votingPower":"0x1e","vrfPublicKey":"0x02dd01a522276c9b2827f147c2e284cc5120bbc3151a08e9a83759b9caebefb3aa"},"0x972945f97f35e57fb0d34f5d5632a57da6da0d0dfafe6f7d79e9a1a6c1a0c70a":{"publicKey":"0x141777835d6fcbe9bada5ee8b557451681138971268ba1f92d13c924d6c8f2d376cf6fc579a400ceccc423067200d7b30f0a8c7eb6c9081a2cd9cef343a88c6547ac633777fb32280b91ed44ea40b3489a2286a90d868ff49c69da64556efe95","votingPower":"0x1","vrfPublicKey":"0x03359971f04b033500d254430915172d7dd28fa937a4dbb99c7d9cf943ad253cea"},"0x98804f1a8e879cb3912816ab1dadb493bbe110902358077bd67da17796cd139a":{"publicKey":"0x09b462ef748bceb092f4a46385ceece356c0552509019e8eedead3cd12ce14bb51b3aed6fe3ea5e6ccca1cd3caf9f2910beb8a93801c70af07261c607ed983eaad838d5b4fa71c06a74fb08910d7d5be1c0ecdd8cdfe7db14217112f44194d9a","votingPower":"0x13","vrfPublicKey":"0x025551d495d3ed18116b50fa76d631d22284be96fce01324fbc38c8f5dab4c2dc4"},"0x9e63ddb4b9e9fd770ca02fb285af4237cb0a65a269ff40e747e80d93374e6fc6":{"publicKey":"0x16732ced98aac3bb3889487fbe35fd96bd94236945d515bb8e79cc27c313d2e5b413ef2ae127303d8f9a8ba9b8cc437414b187068fca503e710ea5180adf1fc5465bf99d568634371de0a82cbfbe2021444684249487ecdd4283f17b9d1af315","votingPower":"0x1","vrfPublicKey":"0x03e82fbc8f4f299ee837acf1a8a2013120572c249bcc67a4aff75bc75ad405fb22"},"0xbaeb67e7cd81a788060fdb53badc74177e550bd36585287e4f4a034fb821676c":{"publicKey":"0x100edc75380622cac7fac32dbcf8a19816c861e24e216c6976dc2164aecab54525dc225a2dc7837dc16da6a745f5cc0e09ab481020ba040568130c7460e540abbcc3195642436d019bd479c4addbebc1f5844b1beb30a049764a2cb553f8f2f7","votingPower":"0x21","vrfPublicKey":"0x0320b9b15659a5cc6561ed3661892444fbbdf88a8d58846a053839a8cf3e49cf00"},"0xbec7e19d019851f49580b6748d00adfb589d42bc0758a5fecaa1bfdc7da46c45":{"publicKey":"0x054063b730fa72ff838bef2aa9b09230c95517ba63642e0416b9f76259cf58f693142daae0124a01632979c2ec8d27bf0a42280349b413cdf099a767487dffd74afb252457d556e17da42ed33e470f2b78db28e833b864ce7bf0e7aa6ae5cb8f","votingPower":"0x11","vrfPublicKey":"0x02f96260693bf7fc9b9895098ca260293386d0262be2a74d013c4b766e55faa5c4"},"0xbf52b3b6fe4c2778b69f32aaae791b4f5cc0d79bdf782b2599d887ba620aece4":{"publicKey":"0x079a04c9c0bf16b5ddbd015107479f4b40c8a1dbfa2cd664a5428b86a1c6d9f645d4495a6029cc572e6bb94bb5937ffa012d200e0eecf75483e4bfaac605dc34dbff7a2c74ca52ef66f2fcbd3d5f7d7ac00ce884fe8461baaf92c4ef4fda82b1","votingPower":"0x11","vrfPublicKey":"0x038780d40c300d4bb81d14be5e86460593b1c6245dd97746e978c0306ddafc3410"},"0xd8245b2dde40341356d439a2d83962a394dabd4f5917e56343a7171f7d1c68f6":{"publicKey":"0x14ffc27625452b2a375459935ae6526412ab1c56cc6b64092b325581622c59d4a1b0b4df79b8752d4ab2c5dcdfe4434513b01bc445ac89ffb13de8c83d3d9882c182a240678d7899df3c357164043274d5e5a5d1967c2a15c54bcda787f5f362","votingPower":"0x2","vrfPublicKey":"0x023cea1dbc449e2c900ee0ea9637877ba015716bf5ddbf776c3968c9449c155bbd"},"0xe6e247242147b83de97e43c6c07afcfe2935aa8a2879e96f29990a04860288ee":{"publicKey":"0x19526386992cc06081a0f6c641501176efd4a31de469feeaf7c4c19697938d810107fdee5726387242af228d041f0eb900c20a52660ab8aeb3ef266d7c84adb5a2f147c7403f2c70e5f38859c63fbfa39dc65e5b4e34dadb076f9bb8c3cea105","votingPower":"0x1","vrfPublicKey":"0x0381833ba91b016a36b64c50457359a628bf384ab30fff13e73ed979359119e428"},"0xef2693fb1f890a862d5bb4bf43fa0eda4ef37879cb5a4d4472d9bcbd4ec0cd70":{"publicKey":"0x061e78b4b76611dc6707348fb4d7d736c552f43c020fcad2b27fc4c6e0e8220de283ede04aab06ae88f022fd2dc1cb6904a50eeaa1e176ff0d39f67178d06dca59faaeceefd5a7ce2d270981839f904b9239cb140a8afbc40aa0f117ffdc6680","votingPower":"0x16","vrfPublicKey":"0x02986545e021c74c6b33a2b9acb067fdf80d4065e41fb653f7c506933878f053a8"}},"quorumVotingPower":"0xc9","totalVotingPower":"0x12c"},"vrfSeed":"0xbe326485f7d4ed5f5a4fcad6b67798860ac43c5aafe0dffaafe31bd987430cb8"}`
	var l EpochState
	err := json.Unmarshal([]byte(expect), &l)
	assert.NoError(t, err)

	actual, err := json.Marshal(l)
	assert.NoError(t, err)

	fExpect, fActual := utils.FormatJson(expect), utils.FormatJson(string(actual))
	assert.Equal(t, fExpect, fActual)
}

// {"epoch":"0x1234","verifier":{"addressToValidatorInfo":{"0x4dbe13565ee9eef1277f72d1e27b688a1087af13c721d3bf715d6e752151382b":{"publicKey":"811e103da17df9f6c0c09bad05b70c31bbbbab28d0d7e3f3a345a91989bc8cc3ec55c962d23f502d67ae6c990b3f7ae5","votingPower":"0x45","vrfPublicKey":"03ee1e0bf295eb52c699719b8977ffd3c932b923947449c8d161bbc6d46478d4ed"},"0x941f97b7f878abc15dcd289e643e639f22484d94c0908a1ff4afee53f142df0c":{"publicKey":"b23b0c6ef4e1a68a0d3a65061674a9013650c5105d1eb647b85b94e3781d034ae7e5e5419b2d71fb01b1f988412dd39d","votingPower":"0x22","vrfPublicKey":"02babc924839a01bf02a3b8de2ec9689323dabc60259a543e1c219607c1caaa537"},"0x9f77c402afa0b04b2e38d39381890387a8fd2c621c0862129146b2de335cd964":{"publicKey":"b157f238403a5b980546fd19ca48f79a2613e3e3a91d14ee69908b8816e4c53665370b2fbd0db62cc4aa0e8caeedc9b5","votingPower":"0x3d","vrfPublicKey":"02b49bbfe4e9e7523dc916c37697f8d71fefc9583691dfc453946bd408173d60a6"},"0xc035f831f4808318d19d3eaf472fe3b42b68f8646a91eed00e1311f8241a865c":{"publicKey":"b51a7f24113e37ea2196af5fcd9a6bd46e0bf861e01c341151860ee9de82092c35260ad0730fe05d41e1bf33bc1ab111","votingPower":"0x3e","vrfPublicKey":"03fe232b62992e3f70118f7c6ecce444adfa156c739e3ed2ac08baf24d873baf0a"},"0xcfc244d9dfa7f3ba4a804a5e0bbb17267a1322492d020b2d310a650f69a318ac":{"publicKey":"951c6d12712c257d7ca1a566b6bb85f6095d92be85d38d3a01af21f4d7c51f5c98b2fff27ffc5e57a81aa8725d7c7040","votingPower":"0x4a","vrfPublicKey":"03f0964ebf270aa24b17b474f7f9113373d71152ecfe4114f0eedd0b2a6b2cb7b5"}},"quorumVotingPower":"0xc9","totalVotingPower":"0x12c"},"vrfSeed":"0xc1db63a832a8aa3ee92623359ddcf0acdecc26c4d08c4b50f47cd72cc52cfbe0"}

func TestUnmarshalAccount(t *testing.T) {
	expect := `{"address":"0xbec7e19d019851f49580b6748d00adfb589d42bc0758a5fecaa1bfdc7da46c45","blockNumber":"0x14bc2e","status":{"inQueue":[{"endBlockNumber":"0x14bc6b","power":"0x1"},{"endBlockNumber":"0x14bd6b","power":"0x1"},{"endBlockNumber":"0x14bfa2","power":"0x8"},{"endBlockNumber":"0x14c044","power":"0x1"},{"endBlockNumber":"0x14c189","power":"0x6e"},{"endBlockNumber":"0x14c1c9","power":"0x1"},{"endBlockNumber":"0x14c3ac","power":"0xc9"},{"endBlockNumber":"0x14c8c4","power":"0xa"},{"endBlockNumber":"0x14d2cd","power":"0x1"},{"endBlockNumber":"0x14d9c6","power":"0x1"},{"endBlockNumber":"0x14debe","power":"0x1"},{"endBlockNumber":"0x14e0d7","power":"0x4"},{"endBlockNumber":"0x14e1bd","power":"0x1f"},{"endBlockNumber":"0x14e2c3","power":"0x5"},{"endBlockNumber":"0x14e517","power":"0x6d"},{"endBlockNumber":"0x14e546","power":"0x1"},{"endBlockNumber":"0x14e592","power":"0x1"},{"endBlockNumber":"0x14e65f","power":"0x2"},{"endBlockNumber":"0x14ea0b","power":"0xb"},{"endBlockNumber":"0x14ea0f","power":"0x1"},{"endBlockNumber":"0x14ea30","power":"0x5"},{"endBlockNumber":"0x14eb09","power":"0x13"},{"endBlockNumber":"0x14ec84","power":"0x12"},{"endBlockNumber":"0x14ee9d","power":"0x1"},{"endBlockNumber":"0x14eec9","power":"0x1"},{"endBlockNumber":"0x14f246","power":"0x4"},{"endBlockNumber":"0x14f4f9","power":"0x9"},{"endBlockNumber":"0x14f4fc","power":"0x4"},{"endBlockNumber":"0x14f8c6","power":"0x5e"},{"endBlockNumber":"0x14fb5e","power":"0x1"},{"endBlockNumber":"0x14fce6","power":"0x2"},{"endBlockNumber":"0x14fe72","power":"0x1c"},{"endBlockNumber":"0x150042","power":"0x1"},{"endBlockNumber":"0x15054a","power":"0x1"}],"locked":"0x3677","outQueue":[{"endBlockNumber":"0x14be28","power":"0x5e"}],"unlocked":"0xd7ec","availableVotes":"0x3928","forceRetired":null,"forfeited":"0x0"}}`

	var acc Account
	err := json.Unmarshal([]byte(expect), &acc)
	assert.NoError(t, err)
	fmt.Printf("acc: %v\n", acc)
}
